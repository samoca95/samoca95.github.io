[
{
		"title": "SHAP structures analysis",
		"date":"Fri Jan 31 2025 22:08:02 GMT+0000 (Coordinated Universal Time)",
		"url":"/ph-d-notes/22-events/efdc-1-euromech-2-d-vs-3-d-shap/shap-structures-analysis/",
		"content": "1. The percolation issue\nWhen comparing the percolation curves of the 2D and 3D SHAP values, we observe: Caption: Comparison of the percolation curve for the 3D case (left) and the 2D case (right).\nTwo main factors contribute to the shift toward lower H values in the 2D case:\n\nDimensional Discrepancy: In 2D, the relative area of a structure does not directly correspond to its relative volume in 3D. For example, structures aligned with the Z plane may appear large in 2D (i.e., high V/Vtot) but can be much smaller in 3D if their transversal dimension is limited. This mismatch leads to artificially inflated 2D V/Vtot values.\nAmbiguity in Structure Identification: A single 3D structure with a transversal extent can intersect a given z-plane at multiple, spatially separated &quot;lobes.&quot; In a 2D slice, it is impossible to determine whether these separate areas belong to the same 3D structure or to different ones. At lower H values, where structures are larger, more lobes may intersect the plane. This increases the apparent number of structures in 2D, shifting the 2D N/N_tot curve to the left.\n\n[!info] Note:\nAs a result, our preliminary conclusion is that the 2D percolation curve does not provide useful guidance for determining the optimal H value.\n\n2. Looking for the optimal H in 2D\nTo determine a suitable H value for segmenting the 2D domain, several alternatives were explored:\n\nID\nH value\nDescription\n\nHperc2D\n0.56\nMaximizes N/Ntot for the 2D database.\n\nHperc3D\n1.62\nMaximizes N/Ntot for the 3D database.\n\nHopt2D\n2.16\nGlobal H value that minimizes the error between the 2D and 3D databases.\n\nlocalHopt2D\nNA\nLocal H value that minimizes the 2D vs 3D error for a given field.\n\nThe error between the 2D and 3D segmentations is defined as:\nerror=1NtNzVT∑t∑z∑j∑i|Mij3D−Mij2D|⋅Vijwhere Mij3D is the boolean array obtained by applying the threshold:\nϕu2(x,y)+ϕv2(x,y)≥H⋅ϕu2―(y)+ϕv2―(y)The segmentation results are shown below:\n\nCaption: Segmentation of the domain for each H value, snapshot 8000, zcut=48. 2D results appear on the left; 3D results on the right.\nAnd these are the resulting PDFs:\n\nCaption: PDFs for different H values. 2D results are on the left; 3D results on the right.\nOptimizing H does not seem to make the 2D and 3D results converge. Therefore, we turn our attention to a statistical analysis.\n\n3. Beyond H, the rest of the threshold\nThe segmentation threshold condition is the product of a constant H and a y-dependent factor:\nϕu2(x,y)+ϕv2(x,y)≥H⋅ϕu2―(y)+ϕv2―(y)A comparison of ϕu2―(y)+ϕv2―(y) for the 2D and 3D cases reveals a significant difference in behavior up to y+≈15:\n\nCaption: Evolution of the y-dependent threshold for the 2D case (purple), 3D case with only horizontal and vertical velocities (blue), and 3D case with all velocity components (green). The results are non-dimensionalized using the mid-channel value for comparison.\n\n[!important] Observation:\nThis difference translates into a much larger threshold for the 2D case for the same value of H for y+&lt;15. Thus introducing a bias during segmentation.\n\n[!Example] Verification\nA test was done where the 3D threshold curve was applied to the 2D segmentation. The results are shown below:\n\nCaption: PDF of the 2D SHAP values using the ϕu2―(y)+ϕv2―(y) factor from the 2D data (left) versus the 3D data (right). Note that both PDFs correspond to the 2D case, with only the y-dependent threshold adjusted.\n\nThe &quot;legs&quot; of the distribution for y+&lt;15 are broader when the 3D threshold is used, indicating that more structures are captured in that region.\nNote that the PDF is normalized such that the maximum bin equals 1. If the number of structures captured for y+&lt;15 is substantially higher than in regions with y+&gt;15, the larger bin dominates the normalization, rendering the number of structures in the u+&gt;0,y+&gt;15 region nearly insignificant in the plot (the minimum color is not zero).\n\nThis theory is further supported by adjusting the colormap range:\n\nCaption: Same as the previous figure, but with a reduced minimum for the colormap range.\n\nIt is important to note that the modification of the factor ϕu2―(y)+ϕv2―(y) is not arbitrary—it reflects a statistical property captured by the SHAP values. Detailed analysis indicates that ϕu2―(y) is the main responsible for these discrepancies. So, the next question is: Why is there such a difference in the evolution of ϕu2―(y)+ϕv2―(y) between the 2D and 3D cases?\n\n4. Identifying the problem\nExamining the instantaneous fields reveals that the high values of ϕu2―(y)+ϕv2―(y) near the wall are not inherited from the input velocity fields or from the U-net predictions. However, a closer look at the instantaneous horizontal SHAP values shows some irregular behavior in the near-wall region for the 2D case:\n\nCaption: Instantaneous horizontal SHAP fields. The left plots show the 2D case, and the right ones show the 3D case. The upper plots display the entire domain, while the lower plots focus on the near-wall region up to y+≈15, where the discrepancies are most pronounced.\nIn the 2D case, spurious phenomena seem to occur close to the wall, which are not present in the 3D SHAPs. This pattern is consistent across multiple snapshots and explains the different statistical evolution for low y+ values. Interestingly, preliminary results for the 2D case including all three velocity components (u, v, and w) show that the spurious behavior is mitigated compared to the 2D case with only u and v:\n\nCaption: Instantaneous horizontal SHAP field for the 2D case with u, v, and w in the near-wall region.\nNote that apart from including the w component, the code remains unchanged between the 2D-uv and 2D-uvw cases.\n\n5. Open Questions\nSeveral questions remain:\n\n[!faq] Questions to be Answered:\n\nPhysical Explanation:\nDoes this behavior have a physical basis? Is it reasonable to observe these results in the 2D case?\n\nSHAP Implementation:\nCould the issue be related to the SHAP implementation? Are we overlooking something when adapting it to 2D?\n\nCode Integrity:\nIs there a potential bug in the code that could be causing these discrepancies?",
		"tags": [ "note"]
},

{
		"title": "Two-Point Spatial Correlation Function",
		"date":"Fri Jan 31 2025 22:08:02 GMT+0000 (Coordinated Universal Time)",
		"url":"/resources/statistics/two-point-spatial-correlation-function/",
		"content": "Two-point spatial correlation of two variables (also called two-point cross-correlation) is a procedure usually applied to investigate the spatial relation between two variables, respectively, at two spatial points in a turbulence field. Two-point cross-correlation coefficient of two variables ϕi and ψi is defined for two locations as:\nRij(xr,x)=⟨ϕi(xr)ψj(x)⟩⟨ϕi2(xr)⟩⟨ψj2(x)⟩where the subscription r denotes the reference point; ϕ and ψ are fluctuations of two variables or components, e.g. velocity, vorticity, temperature, pressure, shear stress. Here, the numbered indices, i and j (i,j=1,2,3), respectively indicate the streamwise (x-direction), wall normal (y-direction) and spanwise (z-direction) directions, and ⟨⋅⟩ denotes an ensemble average of realizations.",
		"tags": [ "note"]
},

{
		"title": "Draft - SHAP structures analysis",
		"date":"Fri Jan 31 2025 22:08:02 GMT+0000 (Coordinated Universal Time)",
		"url":"/4-notes/draft-shap-structures-analysis/",
		"content": "The percolation issue:\nIf we compare the percolation curves of the 2D and the 3D SHAP values, we obtain:\n\nCaption: comparison of the percolation curve of the 3D case (left) and the 2D case (right)\nWe see two main reasons for the shift towards lower values of H in the 2D case:\n\nThe relative area of a structure in 2D does not correspond directly to its relative volume in 3D. Structures aligned with the Z plane may appear large in 2D (high V/Vtot) but be much smaller in 3D if their transversal dimension is small, leading to fictitional 2D V/Vtot values.\nA single 3D structure with a transversal dimension can have multiple &quot;lobes&quot; intersecting the same z-plane at different locations. In a 2D cut, there is no way to determine whether these separate areas belong to the same 3D structure or different ones. Lower H values result in larger structures and potentially more lobes intersecting the plane, artificially increasing the number of structures per field in 2D. This shifts the 2D N/N_tot curve to the left, as we observed.\n\n[!info] Because of this, our preliminary conclusion is that the 2D percolation curve does not provide much useful information regarding the optimal H value to be used.\n\nLooking for the optimal H in 2D\nIn order to try to have insights on which H should be used for the segmentation of the 2D domain, several alternatives have been tried:\n\nID\nH value\nDescription\n\nHperc2D\n0.56\nValue that maximizes N/Ntot for the 2D database\n\nHperc3D\n1.62\nValue that maximizes N/Ntot for the 3D database\n\nHopt2D\n2.16\nGlobal H value that minimizes the error between the 2Dvs3D databases\n\nlocalHopt2D\nNA\nLocal H value that minimizes the 2Dvs3D error for the given field\n\nWhere the formula used to minimize the error between the 2D and the 3D segmentation is:\nerror=1NtNzVT∑t∑z∑j∑i|Mij3D−Mij2D|⋅Vijbeing Mij3D the boolean array resulting of applying the threshold ϕu2(x,y)+ϕv2(x,y)≥H⋅ϕu2―(y)+ϕv2―(y).\nThe results for the segmentation are the following:\n\nCaption: segmentation of the domain for each of the H values, snapshot 8000, zcut=48. The 2D results are shown at the left, 3D results at the right.\nAnd these are the resulting PDFs:\n\nCaption: PDFs obtained with the different H values. The 2D results are shown at the left, 3D results at the right.\nBeyond H, the rest of the threshold\nIf we take a look to the threshold condition, there is the term on the box:\nϕu2(x,y)+ϕv2(x,y)≥H⋅ϕu2―(y)+ϕv2―(y)Comparing it for the 2D and 3D case we can see a big difference in its evolution up to y+≈15:\n\nCaption: evolution of the y-dependent threshold condition for the 2D case (purple), 3D case with only horizontal and vertical velocity (blue), and 3D case with all velocity components (green).\n\n[!important] This difference translates into a much larger threshold for the 2D case for the same value of H for y+&lt;15. Thus introducing a bias during segmentation.\n\nTo verify this, I have run a test case where 3D curve was used for the segmentation of the 2D case. Here are the results:\n\nCaption: PDF of the 2D SHAP values using the ϕu2―(y)+ϕv2―(y) factor obtained from the 2D data (left) and from the 3D data (right). Note that both of them are for the 2D case, just the y-dependent threshold has been adjusted.\n\nThe legs up to y+=15 are broader when we use the 3D threshold evolution, this already demonstrates a higher amount of structures being captured in that region.\nAdditionally, it is important to note that the PDF is adimensionalized with the maximum bin of the histograms conforming it (thus max = 1). Therefore, if the numbers of structures being captured below y+ 15 has substantially increased compared to the higher regions of the domain, the larger bin is now larger, making the number of structures in the u+&gt;0,y+&gt;15 region insignificant to be represented in the plot (note that the minimum color is not 0).\nThis theory is easily proved reducing the minimal value of the colormap range:\n\nCaption: same as last figure but with reduced minimum for the colormap range.\n\nThis modification of the factor ϕu2―(y)+ϕv2―(y) is fictional though, it represents something statistically captured by the SHAP values, an individual analysis shows that ϕu2―(y) is the one introducing such discrepancies. So the question to be made is: Why are we having such difference in the evolution of ϕu2―(y)+ϕv2―(y)? Is it noise due to the lower amount of data? Or could it be fundamental to the 2D case?\n\n[!QUESTION] Why do we have way more structures being captured for y+&lt;15?\nThe increase in captured structures might be due to the topology of those structures. Could they be more tridimensional than for higher positions? This would justify an increase on the number of fictional 2D structures being identified. The PDF of the w component of the 3D SHAP values shows that it is most relevant close to the wall:\n\nCaption: PDF of the transversal velocity component of the SHAP values obtained from the 3D database.",
		"tags": [ "note"]
},

{
		"title": "Home to Digital Garden",
		"date":"Fri Jan 31 2025 22:08:02 GMT+0000 (Coordinated Universal Time)",
		"url":"/",
		"content": "Welcome. This is my personal vault to share ideas and information with others.\nIndex of notes:\n\nFile\nLast Modified\nDate Created\n\n<a class=\"internal-link\" target=\"\" data-note-icon=\"\" href=\"/ph-d-notes/22-events/efdc-1-euromech-2-d-vs-3-d-shap/shap-structures-analysis/\">SHAP structures analysis</a>\n11:07 PM - 2025_01_31\n2025_01_31\n\n<a class=\"internal-link\" target=\"\" data-note-icon=\"\" href=\"/4-notes/draft-shap-structures-analysis/\">Draft - SHAP structures analysis</a>\n10:42 AM - 2025_01_31\n2025_01_30\n\n<a class=\"internal-link\" target=\"\" data-note-icon=\"\" href=\"/\">Home to Digital Garden</a>\n5:09 PM - 2025_01_30\n2025_01_30\n\n<a class=\"internal-link\" target=\"\" data-note-icon=\"\" href=\"/resources/statistics/two-point-spatial-correlation-function/\">Two-Point Spatial Correlation Function</a>\n4:28 PM - 2025_01_30\n2025_01_14",
		"tags": [ "note","Fleeting","gardenEntry"]
}
]